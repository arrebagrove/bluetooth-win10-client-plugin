// This file was generated by Bluetooth (R) Developer Studio on 2016.03.17 21:39
// with plugin Windows 10 UWP Client (version 1.0.0 released on 2016.03.16).
// Plugin developed by Matchbox Mobile Limited.

Plugin: Windows 10 UWP Client
    Plugin Description: Generates C# source code to work with given profile
Authors: Matchbox Mobile Limited
Plugin Version: 1.0.0
Plugin Release Date: 2016.03.16
Source Code Generation Date: 2016.03.17 21:39

1. How to include and start using the code

- Copy all output files and directories into your project directory (preferably into a new sub-folder)
- Import all those files into your project
- All generated classes are in com.matchboxmobile.ble.wrappers namespace and you can start using them immediately
    - You can change that namespace by setting the NAMESPACE property of your BDS project, before generating the code
    - Be aware that the final C# namespace always ends with additional suffix: ".ble.wrappers"

2. How to use the code

- You can start using the BleHeartRate class right away, and connect with a dedicated device, by calling one of:
    - var device  = await BleHeartRate.FirstOrDefault(); -> one device or null
    - var devices = await BleHeartRate.FindAll();        -> list of all found devices (could be empty)
- Be aware that after finding a device, the system initiates the process of connecting to it, but the device can still be disconnected when you receive a reply from FirstOrDefault()/FindAll() function. You should monitor the state of connection:
    - device.DeviceConnectionStatusChanged += ConnectionStatusChangedCallback;
        where ConnectionStatusChangedCallback is a function:
    - public async void ConnectionStatusChangedCallback(object device, BleDeviceConnectionStatusChangedEventArgs args) { ...
- Wait for any further action until you are sure that the device is connected. You can check that state inside the above callback:
    - bool connected = (args.ConnectionStatus == BluetoothConnectionStatus.Connected);
- If you want to read some characteristic's value, you need to traverse full path (device -> service -> characteristic) and call ReadAsync():
    - var reply = await device.DeviceInformation.HardwareRevisionString.ReadAsync();
    - reply is of type GattReadResult, and you can get underlying value (in form of IBuffer):
        IBuffer buffer = reply.Value;
    - before getting the value from the result, check if read operation was successful by calling:
         if (reply.Status == GattCommunicationStatus.Success) { /* instruction to get and process the value */ }
- Unfortunately every characteristic has its own format and fields, so you need to process IBuffer on your own and extract particular values. There is a helper abstract class for that though - BleValueParser<TRead, TWrite>
    - by subclassing it and implementing one or both of the functions:
        protected abstract TRead ParseReadValue(IBuffer raw);
        protected abstract IBuffer ParseWriteValue(TWrite data);
      you can easily add high-level support for your characteristic with a few lines of code.
    - TRead defines what the output type of the characteristic is while reading from it
    - TWrite defines what type should be used when we want to write the characteristic
        - in most cases TRead and TWrite will be the same type, but a split was done, so it is more flexible and can handle more complex scenarios
    - you can find and check how it is working, by looking into one example we provided to you already, which is HeartRateMeasurementParser inside Parsers subdirectory (if you are working with some other device, you can easily delete that single file). You can find official documentation for that characteristic here [https://developer.bluetooth.org/gatt/characteristics/Pages/CharacteristicViewer.aspx?u=org.bluetooth.characteristic.heart_rate_measurement.xml]
        - it supports only reading from the characteristic, but it should give you an idea of that class
    - similarly to the above example, you can add support for other characteristics
    - ValueParsers are separated from the device/characteristic by default. After creating one, you need to assign it to the particular characteristic:
        HeartRateMeasurementParser HrParser = new HeartRateMeasurementParser();
        HrParser.ConnectWithCharacteristic(device.HeartRate.HeartRateMeasurement);
    - now you can easily get the measurement by calling (note that Heart Rate Measurement characteristic doesn't support reading, so below code will not work in practice, but it gives you the overview how parsers can be helpful for you):
        short heartRate = await HrParser.Read();
- One of the most common operations is enabling Notification from characteristic which supports that operation. To do that just set a listener for notifications (example for hear rate belts):
    - device.HeartRate.HeartRateMeasurement.ValueChanged += HeartRateMeasurementOnValueChanged;
        where
    - private void HeartRateMeasurementOnValueChanged(object sender, ValueChangedEventArgs args) { ... }
    - args.Value is an IBuffer with data, which you need to process further
- and then enable notification for particular characteristic:
    - await device.HeartRate.HeartRateMeasurement.EnableNotifications();
- However, if you decide to implement and use BleValueParser, the above could be easier and look like that:
    - HrParser.ValueChanged += HrParserOnValueChanged;
        where
    - private async void HrParserOnValueChanged(object device, ValueChangedEventArgs<short> arg) { ... }
    - arg.Value will be of type short and will contain heart rate measurement directly available to your code
- with above parser you can enable the notification as before, by calling original characteristic's EnableNotification(), or use a shortcut for it:
    - await HrParser.EnableNotifications();
    
3. Additional notes
    - you can easily modify and reuse the generated code, just remember the license we are using (MIT)
    - after you modify the code, it could be good to make a diff from the original - in case you would need to regenerate the code, you would have a "template" for getting your changes back into the new code
    - all classes generated are derived from BleBase - adding some functionality there and you are able to get it in all places
    - in some cases, generated code may not be compilable or working properly - that is possible if names in the Bluetooth Developer Studio were not set properly:
        - the same name for many services/characteristics
        - missing string with the name
        - etc.
    - in above cases, the preferable solution is to go and modify the BDS project to contain proper names, and then re-generate the code
    - in Parsers subdirectory you can find another two examples for parsers:
        - BatteryLevelParser which allows you to easily get battery level from Battery Level characteristic [https://developer.bluetooth.org/gatt/characteristics/Pages/CharacteristicViewer.aspx?u=org.bluetooth.characteristic.battery_level.xml]
        - StringParser which allows to easily get value from characteristic containing single string (like device name, manufacturer etc)
        - StringParser adds also extension methods to every BleCharacteristic:
            - string val = await MyCharacteristic.ReadAsString() //(UTF8 encoding will be used)
            - string val = await MyCharacteristic.ReadAsUnicodeString() //(UTF16 encoding will be used)
            - GattCommunicationStatus status = MyCharacteristic.WriteAsString(string value) //(UTF8 encoding will be used)
            - GattCommunicationStatus status = MyCharacteristic.WriteAsUnicodeString(string value) //(UTF16 encoding will be used)
            - be aware that calling those methods on any non-string characteristic will most probably crash your application

4. Your generated class structure/model:

   Below you can find a very brief explanation of what classes were created for you and the model for your device:

   namespace com.matchboxmobile.ble.wrappers:
      [BleHeartRate class]:
       |        -> var res = await BleHeartRate.FirstOrDefault(); // first device of this type (or null)
       |        -> var res = await BleHeartRate.FindAll(); // all devices of this type (list; could be empty)
       |       
       +---+ .HeartRate property [ of BleHeartRateService type]:
       |   |    .Name [string] = "Heart Rate"
       |   |    .UUID [string] = "180D"
       |   |    .IsMandatory [bool] = true
       |   +--- .HeartRateMeasurement property [of BleCharacteristic type]:
       |   |        .Name [string] = "Heart Rate Measurement"
       |   |        .UUID [string] = "2A37"
       |   |        .IsMandatory [bool] = true
       |   |        ...
       |   +--- .BodySensorLocation property [of BleCharacteristic type]:
       |   |        .Name [string] = "Body Sensor Location"
       |   |        .UUID [string] = "2A38"
       |   |        .IsMandatory [bool] = false
       |   |        ...
       |   +--- .HeartRateControlPoint property [of BleCharacteristic type]:
       |            .Name [string] = "Heart Rate Control Point"
       |            .UUID [string] = "2A39"
       |            .IsMandatory [bool] = false
       |            ...
       +---+ .DeviceInformation property [ of BleDeviceInformationService type]:
       |   |    .Name [string] = "Device Information"
       |   |    .UUID [string] = "180A"
       |   |    .IsMandatory [bool] = true
       |   +--- .ManufacturerNameString property [of BleCharacteristic type]:
       |   |        .Name [string] = "Manufacturer Name String"
       |   |        .UUID [string] = "2A29"
       |   |        .IsMandatory [bool] = false
       |   |        ...
       |   +--- .ModelNumberString property [of BleCharacteristic type]:
       |   |        .Name [string] = "Model Number String"
       |   |        .UUID [string] = "2A24"
       |   |        .IsMandatory [bool] = false
       |   |        ...
       |   +--- .SerialNumberString property [of BleCharacteristic type]:
       |   |        .Name [string] = "Serial Number String"
       |   |        .UUID [string] = "2A25"
       |   |        .IsMandatory [bool] = false
       |   |        ...
       |   +--- .HardwareRevisionString property [of BleCharacteristic type]:
       |   |        .Name [string] = "Hardware Revision String"
       |   |        .UUID [string] = "2A27"
       |   |        .IsMandatory [bool] = false
       |   |        ...
       |   +--- .FirmwareRevisionString property [of BleCharacteristic type]:
       |   |        .Name [string] = "Firmware Revision String"
       |   |        .UUID [string] = "2A26"
       |   |        .IsMandatory [bool] = false
       |   |        ...
       |   +--- .SoftwareRevisionString property [of BleCharacteristic type]:
       |   |        .Name [string] = "Software Revision String"
       |   |        .UUID [string] = "2A28"
       |   |        .IsMandatory [bool] = false
       |   |        ...
       |   +--- .SystemID property [of BleCharacteristic type]:
       |   |        .Name [string] = "System ID"
       |   |        .UUID [string] = "2A23"
       |   |        .IsMandatory [bool] = false
       |   |        ...
       |   +--- .IEEE1107320601RegulatoryCertificationDataList property [of BleCharacteristic type]:
       |   |        .Name [string] = "IEEE 11073-20601 Regulatory Certification Data List"
       |   |        .UUID [string] = "2A2A"
       |   |        .IsMandatory [bool] = false
       |   |        ...
       |   +--- .PnPID property [of BleCharacteristic type]:
       |            .Name [string] = "PnP ID"
       |            .UUID [string] = "2A50"
       |            .IsMandatory [bool] = false
       |            ...
       +---+ .BatteryService property [ of BleBatteryServiceService type]:
           |    .Name [string] = "Battery Service"
           |    .UUID [string] = "180F"
           |    .IsMandatory [bool] = true
           +--- .BatteryLevel property [of BleCharacteristic type]:
                    .Name [string] = "Battery Level"
                    .UUID [string] = "2A19"
                    .IsMandatory [bool] = true
                    ...


5. References

- Bluetooth (R) Developer Studio [https://www.bluetooth.com/~/media/developer-studio/index]
- BDS Development Story [http://matchboxmobile.com/projects/bluetooth-developer-studio/]
- Plugin Development story [http://matchboxmobile.com/blog/bds-plugin-dev/]
- Plugin Github repository [https://github.com/matchboxmobile/bluetooth-win10-client-plugin]
- Matchbox Mobile Ltd. [http://matchboxmobile.com]
